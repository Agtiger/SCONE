<?xml version="1.0" encoding="utf-8"?>
<Optimizer type="CmaOptimizer">
	<init_file></init_file>
	<use_init_file>0</use_init_file>
	<random_seed>123</random_seed>
	<Objective type="SimulationObjective">
		<signature_postfix>GH</signature_postfix>
		<max_duration>10</max_duration>
		<Model type="Simbody">
			<model_file>models/f0914m.osim</model_file>
			<state_init_file>data/f2354_init_walk_S15.sto</state_init_file>
			<state_init_optimization include_states="*" exclude_states="*_tx;*_ty;*_u" init_std="0.01" min="-0.5" max="0.5"/>
			<integration_method>SemiExplicitEuler2</integration_method>
			<integration_accuracy>0.001</integration_accuracy>
			<use_fixed_control_step_size>1</use_fixed_control_step_size>
			<fixed_control_step_size>0.001</fixed_control_step_size>
			<sensor_delay_scaling_factor>1.0</sensor_delay_scaling_factor>
			<Controllers>
				<Controller type="GaitStateController">
					<stance_load_threshold init_mean="0.1" init_std="0.01" min="0.001" max="1.0" is_free="1"/>
					<leg_load_sensor_delay>0.02</leg_load_sensor_delay>
					<ConditionalControllers>

						<!-- TA stretch reflexes, TA = L+(TA) + F-(SOL) [Geyer & Herr 2010] -->
						<ConditionalController states="EarlyStance LateStance Liftoff Swing Landing">
							<Controller type="ReflexController" symmetric="1">
								<Reflexes>
									<Reflex type="MuscleReflex" target="tib_ant" delay="0.020" KL="3~0.3[0,10]" L0="0.7~0.07[0,2]"/>
									<Reflex type="MuscleReflex" target="tib_ant" source="soleus" delay="0.020" KF="-0.4~0.04[-10,10]"/>
								</Reflexes>
							</Controller>
						</ConditionalController>

						<!-- GAS + SOL F+ reflexes [Geyer & Herr 2010] -->
						<ConditionalController states="EarlyStance LateStance Liftoff">
							<Controller type="ReflexController" symmetric="1">
								<Reflexes>
									<Reflex type="MuscleReflex" target="soleus" delay="0.020" KF="1.0~0.1[0,10]"/>
									<Reflex type="MuscleReflex" target="gastroc" delay="0.020" KF="1.0~0.1[0,10]"/>
								</Reflexes>
							</Controller>
						</ConditionalController>

						<!-- Stance reflexes, [Geyer & Herr 2010] -->
						<ConditionalController states="EarlyStance LateStance">
							<Controller type="ReflexController" symmetric="1">
								<Reflexes>
									<!-- F+ VAS when knee angle < 10 degrees -->
									<Reflex type="ConditionalMuscleReflex" target="vasti" delay="0.010" KF="1.0~0.1[0,10]" C0="0.05~0.005[-1,1]">
										<Condition dof="knee_angle" pos_min="-180" pos_max="-10"/>
									</Reflex>
									<!-- Root stability -->
									<Reflex type="DofReflex" target="hamstrings" source="pelvis_tilt" delay="0.005" KP="1.0~0.1[-10,10]" KV="0.2~0.02[-10,10]" C0="0.1~0.01[-1,1]"/>
									<Reflex type="DofReflex" target="glut_max" source="pelvis_tilt" delay="0.005" KP="1.0~0.1[-10,10]" KV="0.2~0.02[-10,10]" C0="0.1~0.01[-1,1]"/>
									<Reflex type="DofReflex" target="iliopsoas" source="pelvis_tilt" delay="0.005" KP="-3.0~0.3[-10,10]" KV="-0.5~0.05[-10,10]" C0="0.1~0.01[-1,1]"/>
								</Reflexes>
							</Controller>						
						</ConditionalController>
						
						<!-- Swing reflexes, [Geyer & Herr 2010] -->
						<ConditionalController states="Liftoff Swing Landing">
							<Controller type="ReflexController" symmetric="1">
								<Reflexes>
									<!-- L+ reflex for hip flexion -->
									<Reflex type="MuscleReflex" target="iliopsoas" delay="0.005" KL="0.5~0.05[0.0,10.0]" L0="0.65~0.065[0,2]"/>
									<!-- Balance correction for hip flexion -->
									<Reflex type="DofReflex" target="iliopsoas" source="pelvis_tilt" delay="0.005" KP="1.0~0.1[-10,10]" KV="0.5~0.05[-10,10]"/>
									<!-- L- inhibion of HAM -> HFL -->
									<Reflex type="MuscleReflex" target="iliopsoas" source="hamstrings" delay="0.005" KL="-4.0~0.4[-10,10]" L0="0.85~0.085[0,2]"/>
									<!-- F+ retraction reflex for end of swing -->
									<Reflex type="MuscleReflex" target="hamstrings" delay="0.005" KF="0.65~0.065[0,10]"/>
									<Reflex type="MuscleReflex" target="glut_max" delay="0.005" KF="0.5~0.05[0,10]"/>
								</Reflexes>
							</Controller>						
						</ConditionalController>
					</ConditionalControllers>
				</Controller>
			</Controllers>
				
			<Measure type="CompositeMeasure">
				<signature_postfix></signature_postfix>
				<Measures>
					<Measure type="GaitMeasure" name="Gait" weight="100" threshold="0.05" termination_height="0.85" min_velocity="1.0"/>
					<Measure type="EffortMeasure" name="Effort" weight="0.1" measure_type="Wang2012" use_cost_of_transport="1"/>
					<Measure type="CompositeMeasure" name="DofLimits" weight="1" threshold="0">
						<Measures>
							<Measure type="DofLimitMeasure" name="AnkleL" weight="0.1" dof="ankle_angle_l" min_deg="-60" max_deg="60" squared_range_penalty="1"/>
							<Measure type="DofLimitMeasure" name="AnkleR" weight="0.1" dof="ankle_angle_r" min_deg="-60" max_deg="60" squared_range_penalty="1"/>
							<Measure type="DofLimitMeasure" name="KneeL" weight="0.01" threshold="5" dof="knee_angle_l" abs_force_penalty="1"/>
							<Measure type="DofLimitMeasure" name="KneeR" weight="0.01" threshold="5" dof="knee_angle_r" abs_force_penalty="1"/>
						</Measures>
					</Measure>
					<Measure type="CompositeMeasure" name="Posture" weight="1" threshold="0">
						<Measures>
							<Measure type="DofLimitMeasure" name="Pelvis" dof="pelvis_tilt" min_deg="-15" max_deg="15" abs_range_penalty="1"/>
						</Measures>
					</Measure>
				</Measures>
			</Measure>
				
		</Model>
	</Objective>
</Optimizer>
